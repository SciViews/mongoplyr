<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute a schema for a MongoDB collection — mongo_schema • mongoplyr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="152x152" href="../apple-touch-icon-152x152.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- svPkgdown --><script src="../script.js"></script><!-- themify icon --><link rel="stylesheet" href="../themify-icons.css?nocache=123"><!--<link rel="stylesheet" href="../style.css?nocache=123">--><!-- bootstrat v4.1.1, required CSS from more recent version --><link rel="stylesheet" href="../bootstrap.more.css?nocache=123"><link href="../style.css?nocache=123" rel="stylesheet"><!-- end of addition for svPkgdown --><meta property="og:title" content="Compute a schema for a MongoDB collection — mongo_schema"><meta property="og:description" content='A DRDL schema is required to match SQL queries with MongoDB aggregation
language because MongoDB do not store structured data. However, your data may
have a intrinsic structure, which is computed. mtcars_schema() provides
precomputed schema for the mtcars dataset, see also ?mtcars for example
and testing purpose in the absence of the "mongodrdl" binaries (correct
providing the mtcars data are inserted unmodified in an empty collection).'><meta property="og:image" content="https://www.sciviews.org/mongoplyr/logo.png"><meta name="twitter:card" content="summary"><!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <!-- preloader start -->
<div class="preloader">
  <img src="../preloader.gif" alt="loading..."></div>
<!-- preloader end -->

<div class="navbar navbar-default navbar-fixed-top bg-secondary" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="navbar-brand-container">
       <div class="navbar-brand-logo">
         <a class="external-link navbar-brand" href="https://www.sciviews.org">
          <img src="../logo_full.png" alt="SciViews"></a>
       </div>
       <div class="navbar-brand-package">
      </div>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <!-- start svPkgdown global site search with Google -->
      <form action="https://www.google.com/search" class="navbar-form navbar-right search-form-global">
        <div class="form-group has-search">
          <span class="fa fa-search form-control-feedback-global"></span>
          <input type="text" class="form-control-global search-form-input" name="q" id="q" placeholder="Search..." required><input type="hidden" name="sitesearch" value="https://www.sciviews.org"></div>
      </form>
      <!-- end svPkgdown global site search with Google -->
      <ul class="nav navbar-nav navbar-right"><li class="nav-item">
  <a class="nav-link" href="../articles/mongoplyr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
        <li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SciViews/mongoplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><div class="navbar-title">
        <a class="navbar-brand" href="../index.html"><p class="h2">mongoplyr <small>v0.0.0.9000</small></p></a>
      </div>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
  <div class="navbar-spacer bg-light">
  </div>
</div><!--/.navbar -->

    <div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute a schema for a MongoDB collection</h1>
      <small class="dont-index">Source: <a href="https://github.com/SciViews/mongoplyr/blob/HEAD/R/mongo_schema.R" class="external-link"><code>R/mongo_schema.R</code></a></small>
      <div class="d-none name"><code>mongo_schema.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A DRDL schema is required to match SQL queries with MongoDB aggregation
language because MongoDB do not store structured data. However, your data may
have a intrinsic structure, which is computed. <code>mtcars_schema()</code> provides
precomputed schema for the <code>mtcars</code> dataset, see also <code><a href="https://rdrr.io/r/datasets/mtcars.html" class="external-link">?mtcars</a></code> for example
and testing purpose in the absence of the "mongodrdl" binaries (correct
providing the <code>mtcars</code> data are inserted unmodified in an empty collection).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mongo_schema</span><span class="op">(</span></span>
<span>  <span class="va">mongo</span>,</span>
<span>  max_scan <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  recalc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"mongotranslate.path"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for mongo_schema</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mtcars_schema</span><span class="op">(</span>db <span class="op">=</span> <span class="st">"test"</span>, collection <span class="op">=</span> <span class="st">"mtcars"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>mongo</dt>
<dd><p>A <strong>mongo</strong> object as obtained from <code>mongo()</code> or
<code>attr(tbl_mongo(), "mongo")</code>.</p></dd>


<dt>max_scan</dt>
<dd><p>The maximum of documents to scan to elaborate the structure
(100 by default).</p></dd>


<dt>recalc</dt>
<dd><p>Is the schema recalculated, in case it is present in the
<strong>mongo</strong> object (<code>FALSE</code> by default)?</p></dd>


<dt>path</dt>
<dd><p>The path to the "mongodrdl" binaries. If it is accessible on the
search path, or indicated in the "mongotranslate.path" option, no need to
specify it.</p></dd>


<dt>x</dt>
<dd><p>A <strong>mongo_schema</strong> object.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> (not used currently).</p></dd>


<dt>db</dt>
<dd><p>The name of the database.</p></dd>


<dt>collection</dt>
<dd><p>The name of the collection.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <strong>mongo_schema</strong> object with the schema as character string and a
sample attribute that contains a data.frame with the three first documents in
the collection, as an example of what is in that collection.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The MongoDB BI Connector's "mongodrdl" external program is used to compute
the schema, unless a "schema" attribute is found in the mongo object and
<code>recalc = FALSE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># We use the same little MongoDB server with mtcars set up for {mongolite}</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SciViews/mongoplyr" class="external-link">mongoplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">database</span> <span class="op">&lt;-</span> <span class="st">"test"</span></span></span>
<span class="r-in"><span><span class="va">collection</span> <span class="op">&lt;-</span> <span class="st">"mtcars"</span></span></span>
<span class="r-in"><span><span class="va">mongodb_url</span> <span class="op">&lt;-</span> <span class="st">"mongodb+srv://readwrite:test@cluster0-84vdt.mongodb.net"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Connect and make sure the collection contains the mtcars dataset</span></span></span>
<span class="r-in"><span><span class="va">mcon</span> <span class="op">&lt;-</span> <span class="fu">mongolite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mongolite/man/mongo.html" class="external-link">mongo</a></span><span class="op">(</span><span class="va">collection</span>, <span class="va">database</span>, <span class="va">mongodb_url</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcon</span><span class="op">$</span><span class="fu">drop</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mcon</span><span class="op">$</span><span class="fu">insert</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># mtcars_schema() returns a precomputed schema for the mtcars dataset</span></span></span>
<span class="r-in"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu">mtcars_schema</span><span class="op">(</span>db <span class="op">=</span> <span class="va">database</span>, collection <span class="op">=</span> <span class="va">collection</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">schema</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This schema can be added as an attribute to the connection to avoid</span></span></span>
<span class="r-in"><span><span class="co"># recalculating it every time</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">mcon</span>, <span class="st">'schema'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">schema</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calling mongo_schema() on a mongo objet that already has a schema attached</span></span></span>
<span class="r-in"><span><span class="co"># just retrieves it (no recalculation)</span></span></span>
<span class="r-in"><span><span class="va">schema2</span> <span class="op">&lt;-</span> <span class="fu">mongo_schema</span><span class="op">(</span><span class="va">mcon</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">schema</span>, <span class="va">schema2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... unless there is nothing attached, or you use recalc = TRUE</span></span></span>
<span class="r-in"><span><span class="co"># In this case, "mongodrdl" must be installed and accessible</span></span></span>
<span class="r-in"><span><span class="co"># see vignette("mongoplyr")</span></span></span>
<span class="r-in"><span><span class="va">schema3</span> <span class="op">&lt;-</span> <span class="fu">mongo_schema</span><span class="op">(</span><span class="va">mcon</span>, recalc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">schema3</span></span></span>
<span class="r-in"><span><span class="co"># There is no particular order in the documents collection. So, do not expect</span></span></span>
<span class="r-in"><span><span class="co"># to get always the same three documents as example</span></span></span>
<span class="r-in"><span><span class="co"># However, the schema in itself should be fairly consistent (extracted with</span></span></span>
<span class="r-in"><span><span class="co">#`as.character()` here)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">schema3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mcon</span><span class="op">$</span><span class="fu">disconnect</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- footer --><!--<footer class="bg-secondary">--><div class="bg-secondary full-width">
    <div class="py-100 border-bottom" style="border-color: #454547 !important">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <div class="mb-5 mb-md-0 text-center text-md-left">
                        <!-- logo -->
                        <img class="mb-30" src="https://www.sciviews.org/images/logo-footer.png" alt="logo"><p class="text-white mb-30"> We build software for reproducible research with R</p>
                        <!-- social icon -->
                        <ul class="list-inline"><li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://github.com/SciViews">
                                    <i class="ti-github"></i>
                                </a>
                            </li>

                            <li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://twitter.com/PhilGrosjean">
                                    <i class="ti-twitter-alt"></i>
                                </a>
                            </li>

                            <li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://www.linkedin.com/in/philippe-grosjean-5b6b29a2/">
                                    <i class="ti-linkedin"></i>
                                </a>
                            </li>

                        </ul></div>
                </div>
                <!-- footer links -->
                <div class="col-lg-2 col-md-4 col-6">
                    <p class="h4 text-white mb-4">Related</p>
                    <ul class="footer-links"><li>
                            <a href="http://econum.umons.ac.be" class="external-link">Our Lab</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/fs/en/" class="external-link">Our Faculty</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/complexys/en/" class="external-link">Complexys</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/infortech/en/" class="external-link">InforTech</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/en/" class="external-link">UMONS</a>
                        </li>

                    </ul></div>
                <!-- footer links -->
                <div class="col-lg-2 col-md-4 col-6">
                    <p class="h4 text-white mb-4">Quick Link</p>
                    <ul class="footer-links"><li>
                            <a href="https://www.sciviews.org/software/svbox" class="external-link">SciViews Box</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/software/sciviews-r" class="external-link">SciViews::R</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/software/zooimage" class="external-link">Zoo/PhytoImage</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/blog" class="external-link">Blog</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/about" class="external-link">About</a>
                        </li>

                    </ul></div>
                <!-- subscribe form -->
                <div class="col-lg-3 col-md-12 offset-lg-1">
                    <div class="mt-5 mt-lg-0 text-center text-md-left">
                             <p class="h4 mb-4 text-white">Contact Us</p>
                             <p class="text-white mb-4">Need more info?<br><a href="mailto:info@sciviews.org"><span class="text-primary">Leave us a mail...</span></a></p>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- copyright -->
    <div class="pt-4 pb-3 position-relative">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-5">
                    <p class="text-white text-center text-md-left">
                        <span class="text-primary">SciViews</span> © All Right Reserved</p>
                </div>
                <div class="col-lg-6 col-md-7">
                    <ul class="list-inline text-center text-md-right"><li class="list-inline-item mx-lg-3 my-lg-0 mx-2 my-2">
                            <a class="external-link font-secondary text-white" href="https://creativecommons.org/licenses/by/4.0/">Site content under CC-BY 4.0 license</a>
                        </li>

                    </ul></div>
            </div>
        </div>
        <!-- back to top -->
        <!--<button class="back-to-top">
            <i class="ti-angle-up"></i>
        </button>-->
    </div>
</div>
<!--</footer>-->
<!-- /footer -->

    </footer></div>

  

  

  </body></html>

